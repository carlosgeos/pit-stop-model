<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>const int MECHS = 4; 
const int MIN_WHEEL_CHANGE_TIME = 2;
const int DELAY_WHEEL_CHANGE_TIME = 10;

typedef int[0, MECHS - 1] mechId_t;

// Boolean array which gets updated whenever a mechanic finishes working on a wheel
bool wheelReady[MECHS];

// The pit can broadcast to all mechanics that the pit is stopped using this broadcast channel
broadcast chan carStopped;

// Urgent, safety channels who mimic the pit behind and the pit in front
urgent chan comingInFront;
urgent chan leavingBehind;


// Just to keep track of real time, this clock is never reset
clock global_time;
</declaration><template><name x="5" y="5">Mechanic</name><parameter>const mechId_t mechId</parameter><declaration>clock x;

void finishWork(mechId_t w) {
	wheelReady[w] = true;
}
</declaration><location id="id0" x="-384" y="-72" color="#ffa500"><name x="-408" y="-48">delay</name></location><location id="id1" x="-192" y="-176"><name x="-176" y="-184">working</name></location><location id="id2" x="-592" y="-176" color="#00ff00"><name x="-656" y="-184">ready</name></location><init ref="id2"/><transition action=""><source ref="id2"/><target ref="id1"/><label kind="synchronisation" x="-432" y="-304">carStopped?</label><label kind="assignment" x="-432" y="-288">x := 0</label><nail x="-496" y="-256"/><nail x="-280" y="-256"/></transition><transition action=""><source ref="id0"/><target ref="id2"/><label kind="assignment" x="-584" y="-64">finishWork(mechId)</label><nail x="-496" y="-72"/></transition><transition controllable="false" action=""><source ref="id1"/><target ref="id0"/><label kind="guard" x="-288" y="-64">x &gt;= DELAY_WHEEL_CHANGE_TIME</label><nail x="-272" y="-72"/></transition><transition controllable="false" action=""><source ref="id1"/><target ref="id2"/><label kind="guard" x="-480" y="-168">x &gt;= MIN_WHEEL_CHANGE_TIME</label><label kind="assignment" x="-480" y="-144">finishWork(mechId)</label><nail x="-280" y="-112"/><nail x="-496" y="-112"/></transition></template><template><name>MainPit</name><declaration>clock x;
clock waitingTime;

bool isCarReady() {
	return forall (i: mechId_t) wheelReady[i];
}

void reset() {
	int i;
	for(i = 0; i &lt; MECHS; i++) {
    		wheelReady[i] = false;
  	}
}
</declaration><location id="id3" x="-320" y="144" color="#ffa500"><name x="-352" y="168">waitingExit</name></location><location id="id4" x="-768" y="144" color="#ffa500"><name x="-824" y="168">waitingEntrance</name></location><location id="id5" x="-584" y="224" color="#ff0000"><name x="-608" y="192">crash</name></location><location id="id6" x="-424" y="-72" color="#00ff00"><name x="-440" y="-104">leave</name></location><location id="id7" x="-320" y="72" color="#00ffff"><name x="-368" y="32">ready_to_leave</name></location><location id="id8" x="-1032" y="72"><name x="-1104" y="40">on_track</name><label kind="invariant" x="-1072" y="88">x &lt;= 5000</label></location><location id="id9" x="-552" y="72"><name x="-584" y="40">car_in_pos</name></location><location id="id10" x="-768" y="72"><name x="-800" y="32">incoming</name><label kind="invariant" x="-800" y="16">x &lt;= 100</label></location><init ref="id8"/><transition action=""><source ref="id3"/><target ref="id5"/><label kind="guard" x="-488" y="208">waitingTime &gt; 50</label><nail x="-496" y="144"/><nail x="-496" y="224"/></transition><transition action=""><source ref="id3"/><target ref="id7"/><label kind="guard" x="-280" y="104">waitingTime &gt; 50</label><nail x="-280" y="112"/></transition><transition controllable="false" action=""><source ref="id7"/><target ref="id3"/><label kind="synchronisation" x="-480" y="96">comingInFront?</label><label kind="assignment" x="-480" y="112">waitingTime := 0</label><nail x="-360" y="112"/></transition><transition action=""><source ref="id4"/><target ref="id5"/><label kind="guard" x="-656" y="152">waitingTime &gt; 50</label><nail x="-664" y="144"/><nail x="-664" y="224"/></transition><transition action=""><source ref="id4"/><target ref="id10"/><label kind="guard" x="-736" y="88">waitingTime &gt; 50</label><nail x="-728" y="112"/></transition><transition controllable="false" action=""><source ref="id10"/><target ref="id4"/><label kind="synchronisation" x="-920" y="120">leavingBehind ?</label><label kind="assignment" x="-920" y="136">waitingTime := 0</label><nail x="-808" y="112"/></transition><transition action=""><source ref="id7"/><target ref="id6"/><label kind="assignment" x="-192" y="-24">reset()</label><nail x="-200" y="72"/><nail x="-200" y="-72"/></transition><transition action=""><source ref="id9"/><target ref="id7"/><label kind="guard" x="-472" y="48">isCarReady()</label></transition><transition controllable="false" action=""><source ref="id8"/><target ref="id10"/><label kind="assignment" x="-944" y="80">x := 0</label></transition><transition action=""><source ref="id10"/><target ref="id9"/><label kind="synchronisation" x="-704" y="48">carStopped !</label></transition></template><template><name>Behind</name><declaration>clock x;</declaration><location id="id11" x="-248" y="-216"><name x="-264" y="-248">car</name></location><init ref="id11"/><transition controllable="false" action=""><source ref="id11"/><target ref="id11"/><label kind="synchronisation" x="-296" y="-120">leavingBehind!</label><nail x="-296" y="-136"/><nail x="-192" y="-136"/></transition></template><template><name>InFront</name><location id="id12" x="-216" y="-168"><name x="-232" y="-200">car</name></location><init ref="id12"/><transition controllable="false" action=""><source ref="id12"/><target ref="id12"/><label kind="synchronisation" x="-264" y="-72">comingInFront!</label><nail x="-272" y="-80"/><nail x="-160" y="-80"/></transition></template><system>system MainPit, Behind, InFront, Mechanic;</system></nta>